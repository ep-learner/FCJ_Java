- 反射
- Class
- 对象 方法
- 评价



# 反射

目的：把类的全路径package.classname放入某个配置文件，此时哪怕实现类还没写，但是已经知道从哪可以获取该类名。这样获取的终究只是一个String，如何**把类名字符串转化为一个可以使用的类**，这就是**反射**。反射可以提供运行时的类信息，并且编译时该类的 .class 不存在也可以加载进来。

## Class

Class类也是类class的一种，只是和关键词class比较像，作用是运行时提供或获得某个**对象的类型信息**。

如何获得Class对象？

- 方法1：

  ```java
  Class<?> c = Class.forName("java.lang.Parent");
  ```

- 方法2：

  ```java
  Parent p = new Parent();
  Class c = p.getClass();
  ```

- 方法3：

  `Class c = String.class;`

## 反射的应用

### 1、一般过程

**step1：用class名创建一个class对象**

```java
Class<?> c= Class.forName(br.readLine());
Class<?> c= Class.forName(String.class);
```

**step2：获取实例**

获取对象时记得转换数据类型，因为newInstance的返回值都是Object

```java
Parent instance = (Parent) c.newInstance();
```

***step3：获取方法***

该方法的参数：函数名；参数1.class ，*** ，参数n.class；

```java
Method func  = c.getMethod("fun_name",String.class,Integer.class);
```

***step4：调用方法：方法.invoke（实例，参数值）***

```java
Object return_val = func.invoke(instance,"我是参数"，111);
```

**step5：通过实例直接调用**

这种方式等价于 Step3+Step4

```java
Object return_val = instance.fun_name("我是参数"，111);
```



### 2、调用有参构造函数的情况

```java
import t.bean;
Class<?> c1 = Class.forName("t.bean");//获得bean的类型信息
```

第一种方式

获取bean的所有public构造函数；即一个构造函数组成的list；
list里面的构造函数的顺序，取决于前面**bean编写构造函数的顺序**；这里假设带一个String参数的构造函数写在最前面。

```java
Constructor<?>[] con = c1.getConstructors();
bean newInstance = (bean)con[0].newInstance("我是参数");
```

第二种方式

这种方式在获取构造函数时，类似前面method的获取方法，先指定参数的类型，后面的使用方式就一致了

```java
Constructor<?> con = c1.getConstructor(String.class);
bean newInstance = (bean)con.newInstance("我是参数");
```

### 总结

通过Class直接获取对象的方式默认调用无参构造函数:

`bean newInstance = (bean)c1.newInstance("我是参数");`

应用中这种是最常见的，但是为了不失去一般性，建议**先获取构造函数再创建实例**；

获取构造函数的方法建议使用**第二种方式**;因为构造函数的编写顺序这种东西你未必能知道，即使知道写起来也比较麻烦，不容易检查。

所以**重述**一遍应用反射的过程：

```java
import t.bean;
Class c = Class.forName("t.bean");

Constructor<?> con = c.getConstructor(String.class);
//调用带一个String的构造函数，此处参数为空时即调用无参构造函数

bean t = (bean)con.newInstance("我是构造函数的参数");

String return_val =t.eat("我是方法eat的参数")
/**
Method m = c.getMethod("eat",String.class);
String return_val = (String)m.invoke(t,"我是传入的字符串参数")
*/
```

### 







